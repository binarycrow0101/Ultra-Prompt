<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Mystic Radio Tuner</title>
<style>
body {
  background: radial-gradient(circle at center, #020202 40%, #000 100%);
  margin: 0; height: 100vh;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  font-family: "Courier New", monospace;
  color: #0ff;
  overflow: hidden;
}

/* --- Screen --- */
.screen {
  position: relative;
  width: 420px; height: 150px;
  background: #001;
  border: 3px solid rgba(0,255,255,0.3);
  border-radius: 10px;
  box-shadow: 0 0 20px rgba(0,255,255,0.2);
  display: flex; align-items: center; justify-content: center;
  text-align: center;
  font-size: 1rem;
  overflow: hidden;
}
#staticCanvas { position:absolute; inset:0; width:100%; height:100%; pointer-events:none; transition:opacity .6s ease; }
.scanline {
  position:absolute; inset:0; pointer-events:none;
  background: linear-gradient(to bottom, rgba(255,255,255,0) 0%, rgba(255,255,255,0.15) 50%, rgba(255,255,255,0) 100%);
  opacity:0.05; animation: scan 8s linear infinite;
}
@keyframes scan { 0%{transform:translateY(-100%);} 100%{transform:translateY(100%);} }
.flickerOverlay { position:absolute; inset:0; background:rgba(255,255,255,0.015); mix-blend-mode:overlay; animation:flicker 5s ease-in-out infinite; }
@keyframes flicker { 0%,100%{opacity:.4;} 50%{opacity:.6;} }

/* --- Text animation --- */
.assembled .char {
  display:inline-block; opacity:0; transform:translateY(5px); filter:blur(3px);
  transition:opacity .2s, transform .2s, filter .2s;
}
.assembled .char.locked { opacity:1; transform:none; filter:none; }

/* --- Dial --- */
.dial-container { display:flex; align-items:center; gap:40px; margin-top:50px; }
.dial {
  width:160px; height:160px;
  background: radial-gradient(circle,#222 0%,#000 90%);
  border:4px solid rgba(0,255,255,0.3);
  border-radius:50%;
  position:relative; cursor:grab;
  box-shadow:inset 0 0 25px rgba(0,255,255,0.15);
}
.pointer {
  position:absolute; width:4px; height:35%;
  top:10%; left:calc(50% - 2px);
  background:#0ff; border-radius:2px;
  transform-origin:bottom center;
  transition:transform .05s linear;
}

/* --- Volume slider --- */
.volume-slider {
  appearance:none;
  width:8px; height:120px;
  background: linear-gradient(to top,#022,#0ff);
  border-radius:8px; box-shadow:0 0 8px rgba(0,255,255,0.2);
}
.volume-slider::-webkit-slider-thumb {
  appearance:none; width:16px; height:16px;
  background:#0ff; border-radius:50%; cursor:pointer;
  box-shadow:0 0 10px rgba(0,255,255,0.4);
}
</style>
</head>
<body>

<div class="screen" id="screen">
  <canvas id="staticCanvas"></canvas>
  <div class="scanline"></div>
  <div class="flickerOverlay"></div>
  <div id="screenContent">~ tuning ~</div>
</div>

<div class="dial-container">
  <input type="range" min="0" max="1" step="0.01" value="0.6" class="volume-slider" id="volumeControl" orient="vertical">
  <div class="dial" id="dial"><div class="pointer" id="pointer"></div></div>
</div>

<script>
// ---------- SOUND SETUP ----------
const bgMusic = new Audio("sounds/background.mp3");
const radioScroll = new Audio("sounds/radioscrolling.mp3");
bgMusic.loop = true; bgMusic.volume = 0.6;
radioScroll.loop = true; radioScroll.volume = 0.6;
let audioInitialized = false;

function initAudio() {
  if (!audioInitialized) {
    audioInitialized = true;
    bgMusic.play().catch(()=>{});
  }
}
document.body.addEventListener("click", initAudio, { once: true });

// Volume control
const volumeSlider = document.getElementById("volumeControl");
volumeSlider.addEventListener("input", e=>{
  const vol = parseFloat(e.target.value);
  bgMusic.volume = vol;
  radioScroll.volume = vol;
});

// ---------- STATIC CANVAS ----------
const staticCanvas = document.getElementById("staticCanvas");
const ctx = staticCanvas.getContext("2d");
function resizeStatic() {
  staticCanvas.width = staticCanvas.offsetWidth;
  staticCanvas.height = staticCanvas.offsetHeight;
}
window.addEventListener("resize", resizeStatic);
resizeStatic();

let staticRunning = false;
function drawStatic() {
  if (!staticRunning) return;
  const w = staticCanvas.width, h = staticCanvas.height;
  const imgData = ctx.createImageData(w,h);
  const d = imgData.data;
  for (let i=0;i<d.length;i+=4){
    const v = Math.random()<0.04?255:Math.random()*180;
    d[i]=d[i+1]=d[i+2]=v; d[i+3]=255;
  }
  ctx.putImageData(imgData,0,0);
  requestAnimationFrame(drawStatic);
}
function startStatic() { staticRunning = true; drawStatic(); staticCanvas.style.opacity=1; }
function stopStatic() { staticRunning = false; staticCanvas.style.opacity=0; }

// ---------- DIAL + PROMPT ----------
const dial = document.getElementById("dial");
const pointer = document.getElementById("pointer");
const screenContent = document.getElementById("screenContent");

let dragging=false, lastAngle=0, currentAngle=0, lastChannel=-1;
const channels=["Dream Residue"]; // just one for now
function angleFromEvent(e){
  const rect = dial.getBoundingClientRect();
  const cx = rect.left + rect.width/2;
  const cy = rect.top + rect.height/2;
  const x = (e.touches?e.touches[0].clientX:e.clientX) - cx;
  const y = (e.touches?e.touches[0].clientY:e.clientY) - cy;
  return Math.atan2(y,x)*180/Math.PI;
}

dial.addEventListener("mousedown",startDrag);
dial.addEventListener("touchstart",startDrag,{passive:true});
document.addEventListener("mouseup",endDrag);
document.addEventListener("touchend",endDrag);
document.addEventListener("mousemove",drag);
document.addEventListener("touchmove",drag,{passive:true});

function startDrag(e){
  initAudio();
  dragging=true;
  lastAngle=angleFromEvent(e);
  dial.style.cursor="grabbing";
  radioScroll.currentTime=0;
  radioScroll.play().catch(()=>{});
}
function endDrag(){
  dragging=false;
  dial.style.cursor="grab";
  radioScroll.pause();
}
function drag(e){
  if(!dragging) return;
  const a=angleFromEvent(e);
  const delta=a-lastAngle;
  currentAngle=(currentAngle+delta)%360;
  lastAngle=a;
  pointer.style.transform=`rotate(${currentAngle}deg)`;
  checkChannel();
}

function checkChannel(){
  const index = 0; // only one channel now
  if(index!==lastChannel){
    lastChannel=index;
    startStatic();
    showStatic(channels[index]);
    setTimeout(()=>displayPhrase(generatePrompt()),600);
  }
}

function showStatic(name){
  screenContent.textContent = `~ ${name} ~`;
}

function displayPhrase(text){
  stopStatic();
  screenContent.innerHTML="";
  const container=document.createElement("div");
  container.className="assembled";
  screenContent.appendChild(container);
  const chars=[...text];
  chars.forEach(ch=>{
    const span=document.createElement("span");
    span.className="char"; span.textContent=ch;
    container.appendChild(span);
  });
  let i=0;
  const timer=setInterval(()=>{
    if(i>=chars.length){clearInterval(timer);return;}
    container.children[i].classList.add("locked");
    i++;
  },50);
}

// ---------- PROMPT GENERATOR ----------
const dreamResidue = {
  roles:["Frog","Elephant","Boar","Raven","Giraffe","Tapir","Weasel","Otter","Beaver","Buffalo","Cow","Spider","Rabbit","Dog","Dinosaur","Octopus","Penguin","Crab","Cat","Bear","Lion","Badgers","Xenomorph","Android","Shark","Unicorn","Shrimp","Raccoon","Turtle","Rat","Pony","Tiger","Ant","Bat","Koala","Sloth","Dragon","Chinchilla","Skeleton","Pigeon","Lobster","Walrus","Armadillo","Chicken","Goblin","Dog","Mermaid","Centaur","Werewolf","Vampire Bat","Gnome","Fairy","Alien Blob","Robot Dog","Mutant Hamster","Zombie Cat","Cyborg Chicken","Mini Dragon","Space Slug","Tentacle Monster","Flying Fish","Talking Donkey","Living Rock","A Painting of a","Haunted Doll","Giant Rat","Fire Sprite","Ice Golem","Shadow Beast","Moon Rabbit","Pumpkin Monster","Cosmic Owl","Time Traveler","Ghost Parrot","Invisible Cat","Frost Troll","Sand Worm","Giant Spider","Banana Knight","Chocolate Ogre","Cheese Dragon","Sock Monster","Killer Whale","Fox","Neon Tiger","Gummy Bear","Jellyfish","Vortex Frog","Crazy Chicken"],
  subjects:["Knight","Wizard","Healer","Archer","Bard","Thief","Necromancer","Paladin","Barbarian","Alchemist","Engineer","Inventor","Pilot","Captain","Admiral","Navigator","Spy","Assassin","Scout","Soldier","General","Guard","Jester","King","Queen","Prince","Princess","Peasant","Farmer","Blacksmith","Miner","Merchant","Scholar","Librarian","Teacher","Student","Priest","Monk","Oracle","Prophet","Shaman","Druid","Hunter","Fisherman","Cook","Butcher","Baker","Brewer","Innkeeper","Explorer","Cartographer","Sailor","Pirate","Smuggler","Outlaw","Sheriff","Detective","Doctor","Nurse","Witch Doctor","Mechanic","Taxi Driver","Racer","Athlete","Gladiator","Champion","Wrestler","Boxer","Samurai","Ninja","Magician","Hero","Villain","Diplomat","Judge","Lawyer","Zombie","Vampire","Robot","Alien","Time Traveler","Storyteller","Painter","Musician","Dreamer","Visionary","Spirit Guardian","Elemental","CEO","Sock Puppet","Kaiju","Transforming","Hippy"],
  actions:["dancing","sleeping","baking cupcakes","painting","singing","fighting","building a Lego set","haunting","surfing","shopping","reading","climbing","eating cheese","solving a mystery","slaying","playing football","comparing hats","casting spells","summoning a storm","building a time machine","hacking a computer","climbing a volcano","riding a giant snail","teleporting","playing hide and seek","chasing shadows","taming a dragon","stealing treasure","creating a potion","swinging on vines","painting graffiti","singing opera","writing a novel","inventing gadgets","dueling with swords","feeding unicorns","swimming with sharks","playing pranks","testing a jetpack","fighting off zombies","wrangling ghosts","building a cheese fortress","stealing a crown","conducting an orchestra","driving a UFO"],
  contexts:["in the Congo","at a TED convention","in a castle","in a spaceship","on the moon","in a haunted house","in a circus","in a swamp","in a library","in a volcano","in a coffee shop","at a wedding","at a funeral","in a classroom","on a pirate ship","on stage","in a candy store","in a pub","at Disney World","in the big city","in a thrift store","on the subway","in hell","at the laundromat","in a gladiator arena","on a cloud","underwater in Atlantis","on a flying carpet","in a haunted forest","at a zombie apocalypse","during a snowstorm","on a rollercoaster","in a neon city","inside a video game","on a space station","on a tropical island","in a secret laboratory","inside a giant robot","at a superhero battle","on a floating island"]
};

function rand(a){return a[Math.floor(Math.random()*a.length)];}
function generatePrompt(){
  return `${rand(dreamResidue.roles)} ${rand(dreamResidue.subjects)} ${rand(dreamResidue.actions)} ${rand(dreamResidue.contexts)}.`;
}

// start initial static
startStatic();
</script>
</body>
</html>
