<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Situational Prompt Spinner</title>
<style>
  :root{
    --bg:#0f1724;
    --card:#0b1220;
    --accent:#8b5cf6;
    --muted:#94a3b8;
    --text:#e6eef8;
    --glass: rgba(255,255,255,0.03);
  }
  html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
  body{
    background: linear-gradient(180deg,var(--bg),#071026 80%);
    color:var(--text);
    display:flex;
    align-items:flex-start;
    justify-content:center;
    padding:18px;
    box-sizing:border-box;
  }

  /* container */
  .app {
    width:100%;
    max-width:1100px;
    display:flex;
    flex-direction:column;
    gap:14px;
  }

  /* header / themes */
  .topbar{
    display:flex;
    gap:10px;
    align-items:center;
    justify-content:space-between;
  }
  .themes {
    display:flex;
    gap:8px;
    overflow:auto;
    padding-bottom:6px;
  }
  .theme-btn{
    padding:8px 12px;
    border-radius:12px;
    background:var(--glass);
    border:1px solid rgba(255,255,255,0.03);
    color:var(--text);
    font-weight:600;
    white-space:nowrap;
    cursor:pointer;
    flex:0 0 auto;
  }
  .theme-btn.active{
    background:linear-gradient(90deg,var(--accent),#4f46e5);
    color:white;
    box-shadow:0 6px 18px rgba(79,70,229,0.18);
  }

  /* main card */
  .card{
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:16px;
    padding:14px;
    box-shadow: 0 6px 24px rgba(2,6,23,0.6);
    border:1px solid rgba(255,255,255,0.03);
  }

  .slots {
    display:grid;
    grid-template-columns: repeat(4, 1fr);
    gap:10px;
    align-items:center;
  }

  .slot{
    background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.015));
    border-radius:12px;
    padding:12px;
    min-height:92px;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    text-align:center;
    position:relative;
    overflow:hidden;
    border:1px solid rgba(255,255,255,0.02);
  }
  .slot .label{
    font-size:12px;
    color:var(--muted);
    margin-bottom:6px;
    text-transform:uppercase;
    letter-spacing:0.08em;
  }
  .slot .word{
    font-size:18px;
    line-height:1.1;
    font-weight:700;
    padding:6px 4px;
    min-height:42px;
    display:flex;
    align-items:center;
    justify-content:center;
  }

  /* controls */
  .controls{
    display:flex;
    gap:12px;
    margin-top:12px;
    align-items:center;
    justify-content:space-between;
    flex-wrap:wrap;
  }
  .left-controls{display:flex;gap:10px;align-items:center}
  .spin-btn{
    font-weight:800;
    padding:16px 26px;
    border-radius:14px;
    background:linear-gradient(90deg,var(--accent),#06b6d4);
    border:none;
    color:white;
    font-size:18px;
    cursor:pointer;
    box-shadow:0 8px 28px rgba(139,92,246,0.18);
  }
  .spin-btn[disabled]{opacity:0.6;cursor:not-allowed}

  .small-btn{
    padding:10px 12px;border-radius:10px;background:var(--glass);border:1px solid rgba(255,255,255,0.03);cursor:pointer;
  }

  .credit{
    font-size:12px;color:var(--muted);text-align:right;
  }

  /* final phrase area */
  .phrase{
    margin-top:12px;
    padding:12px;border-radius:10px;background:rgba(255,255,255,0.02);
    min-height:48px;display:flex;align-items:center;justify-content:center;font-weight:700;
  }

  /* responsive (mobile-first) */
  @media(min-width:640px){
    .slot .word{font-size:20px}
    .slots{gap:12px}
  }

  /* portrait priority: stack on narrow widths */
  @media(max-width:480px){
    .slots{
      grid-template-columns: repeat(1, 1fr);
    }
    .controls{flex-direction:column;align-items:stretch}
    .left-controls{justify-content:space-between}
    .credit{text-align:center}
  }

  /* landscape/tablet: show 4 columns */
  @media(min-width:900px){
    body{padding:28px}
    .slots{grid-template-columns:repeat(4,1fr)}
    .card{padding:18px}
  }

  /* little spin indicator */
  .spinner-dot{height:8px;width:8px;border-radius:50%;background:var(--muted);display:inline-block;margin-left:8px}
  .spin-active .spinner-dot{background:#fff;box-shadow:0 0 8px var(--accent)}
  /* confetti canvas full screen */
  #confetti{
    position:fixed;left:0;top:0;width:100%;height:100%;pointer-events:none;z-index:1200;
  }
</style>
</head>
<body>
<div class="app" role="application" aria-label="Situational Prompt Spinner">
  <div class="topbar">
    <div class="themes" id="themesContainer" aria-hidden="false">
      <!-- theme buttons generated here -->
    </div>
    <div style="display:flex;gap:8px;align-items:center;">
      <button id="muteBtn" class="small-btn" aria-pressed="false" title="Mute/unmute">ðŸ”Š</button>
      <button id="creditsToggle" class="small-btn" title="Credits">i</button>
    </div>
  </div>

  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
      <div style="font-weight:800">Prompt Spinner</div>
      <div style="font-size:13px;color:var(--muted)">Touch spin for a random prompt</div>
    </div>

    <div class="slots" id="slots">
      <!-- slot elements created by JS -->
    </div>

    <div class="controls">
      <div class="left-controls">
        <button id="spinBtn" class="spin-btn" aria-label="Spin">SPIN <span class="spinner-dot" id="spinDot"></span></button>
        <button id="quickSpinBtn" class="small-btn" title="Quick spin (faster)">Quick</button>
      </div>

      <div style="display:flex;gap:8px;align-items:center">
        <div style="font-size:13px;color:var(--muted)">Speed</div>
        <input id="speedRange" type="range" min="1" max="3" value="2" />
      </div>
    </div>

    <div class="phrase" id="finalPhrase" aria-live="polite">Ready â€” choose a theme and press SPIN</div>

    <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px;">
      <div style="font-size:12px;color:var(--muted)">Tap theme to switch banks</div>
      <div class="credit" id="creditArea">Made by You â€¢ Credits here</div>
    </div>
  </div>
</div>

<canvas id="confetti"></canvas>

<!-- Audio elements: we will create Audio objects in JS; kept empty in HTML -->
<script>
/*
  ======== HOW TO USE ========
  - Replace the word lists in the `themes` object below with your real theme lists.
    Each theme has 4 arrays: roles, subjects, actions, contexts.
    Keep the order: roles -> subjects -> actions -> contexts.

  - For per-theme audio: place audio files in same folder and set filenames in `music` property.
    Example: music: { menu: 'menu.mp3', spin: 'fantasy-spin.mp3' }
    The menu music will play when theme selected; spin music will play when spinning.

  - The code prevents overlapping music by stopping current audio before starting next.
  - Mute toggles and persists to localStorage.
  - Confetti animation runs on spin complete.
*/

const themes = {
  Fantasy: {
    roles: ["Wandering Knight", "Cunning Witch", "Old Bard", "Young Squire", "Exiled Prince"],
    subjects: ["a dragon", "a cursed locket", "a talking tree", "a moonstone", "a guild of rats"],
    actions: ["negotiates with", "betrays", "quests for", "accidentally awakens", "tricks"],
    contexts: ["in a half-sunken castle", "during a fae market", "at the witching hour", "while it rains frogs", "before the coronation"],
    music: {menu: "fantasy-menu.mp3", spin: "fantasy-spin.mp3"}
  },
  "Sci-Fi": {
    roles: ["Rogue AI", "Space Salvager", "Clone Operative", "Augmented Pilot", "Time Tourist"],
    subjects: ["an orbital station", "a quantum key", "a stray comet", "a neural parasite", "a civilian drone"],
    actions: ["hijacks", "repairs", "betrays", "teleports", "scrambles"],
    contexts: ["near a collapsing wormhole", "inside a bio-lab", "during a zero-g festival", "on a forgotten colony", "at the last refueling stop"],
    music: {menu: "scifi-menu.mp3", spin: "scifi-spin.mp3"}
  },
  Spooky: {
    roles: ["Graveyard Caretaker", "Pale Medium", "Sleepwalker", "Daring Teen", "Elder Witch"],
    subjects: ["a hollow doll", "a whispering mirror", "a stitched shadow", "a basement choir", "an attic full of clocks"],
    actions: ["summons", "is haunted by", "burns", "unearths", "follows"],
    contexts: ["on All Hallows' Eve", "during a thunderstorm", "right after midnight", "when the lantern goes out", "behind the churchyard wall"],
    music: {menu: "spooky-menu.mp3", spin: "spooky-spin.mp3"}
  },
  Silly: {
    roles: ["Clumsy Chef", "Overexcited Squirrel", "Retired Clown", "Paranoid Librarian", "Tiny Mayor"],
    subjects: ["a talking sandwich", "an inflatable cow", "a runaway pudding", "the neighbor's pet rock", "a suspicious spoon"],
    actions: ["juggles", "accidentally launches", "declares war on", "glues", "sings to"],
    contexts: ["during a pie parade", "in the lost sock dimension", "at the wrong wedding", "under a giant hat", "with questionable enthusiasm"],
    music: {menu: "silly-menu.mp3", spin: "silly-spin.mp3"}
  },
  Superhero: {
    roles: ["Masked Courier", "Reluctant Sidekick", "Veteran Vigilante", "Genetic Teen", "Corporate Sponsor"],
    subjects: ["a power gauntlet", "a city block", "a politician with secrets", "an experimental serum", "a rogue prototype"],
    actions: ["stops", "betrays", "protects", "investigates", "explodes near"],
    contexts: ["during rush hour", "on a rooftop gala", "inside a collapsing skyscraper", "at the televised debate", "while streaming live"],
    music: {menu: "hero-menu.mp3", spin: "hero-spin.mp3"}
  },
  Mashup: {
    roles: ["Cyber-Pirate", "Viking Bot", "Necromancer DJ", "Space Knight", "Time-Traveling Farmer"],
    subjects: ["a haunted spacecraft", "a glowing rune-synth", "a robotic sheep", "an ancient tweet", "a cursed motherboard"],
    actions: ["fuses with", "sings to", "plunders", "invites", "salvages"],
    contexts: ["during the fusion festival", "at the end of the empire", "between two parallel sitcoms", "while everyone is asleep", "on the last ferry"],
    music: {menu: "mashup-menu.mp3", spin: "mashup-spin.mp3"}
  }
};

// UI references
const themesContainer = document.getElementById('themesContainer');
const slotsContainer = document.getElementById('slots');
const spinBtn = document.getElementById('spinBtn');
const quickSpinBtn = document.getElementById('quickSpinBtn');
const speedRange = document.getElementById('speedRange');
const finalPhrase = document.getElementById('finalPhrase');
const muteBtn = document.getElementById('muteBtn');
const creditArea = document.getElementById('creditArea');
const confettiCanvas = document.getElementById('confetti');

let currentTheme = Object.keys(themes)[0];
let slotElements = [];
let intervalHandles = [];
let stopTimeouts = [];
let isSpinning = false;
let currentAudio = null;
let isMuted = localStorage.getItem('spinnerMuted') === 'true';

// tune mobile-first
document.body.classList.toggle('spin-active', false);

// init mute state
function updateMuteUI(){
  muteBtn.textContent = isMuted ? 'ðŸ”‡' : 'ðŸ”Š';
  muteBtn.setAttribute('aria-pressed', isMuted);
}
updateMuteUI();

muteBtn.addEventListener('click', () => {
  isMuted = !isMuted;
  localStorage.setItem('spinnerMuted', isMuted);
  updateMuteUI();
  if(currentAudio) currentAudio.muted = isMuted;
});

// build theme buttons
function buildThemeButtons(){
  themesContainer.innerHTML = '';
  Object.keys(themes).forEach(name => {
    const btn = document.createElement('button');
    btn.className = 'theme-btn' + (name===currentTheme ? ' active' : '');
    btn.textContent = name;
    btn.addEventListener('click', () => {
      if (isSpinning) return; // avoid switching mid-spin
      currentTheme = name;
      document.querySelectorAll('.theme-btn').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      loadTheme(name);
    });
    themesContainer.appendChild(btn);
  });
}

// create slots
function createSlots(){
  slotsContainer.innerHTML = '';
  slotElements = [];
  const labels = ['Roles','Subjects','Actions','Contexts'];
  labels.forEach((label,i) => {
    const s = document.createElement('div');
    s.className = 'slot';
    s.innerHTML = `<div class="label">${label}</div><div class="word" id="slot-${i}">â€”</div>`;
    slotsContainer.appendChild(s);
    slotElements.push(s.querySelector('.word'));
  });
}

// pick random element safely
function pickRandom(arr){ if(!arr || arr.length===0) return 'â€”'; return arr[Math.floor(Math.random()*arr.length)]; }

// load theme content and optionally play menu music
function loadTheme(name){
  const theme = themes[name];
  // initialize slot displays to a random item from each bank
  slotElements[0].textContent = pickRandom(theme.roles);
  slotElements[1].textContent = pickRandom(theme.subjects);
  slotElements[2].textContent = pickRandom(theme.actions);
  slotElements[3].textContent = pickRandom(theme.contexts);
  // update phrase text hint
  finalPhrase.textContent = `Theme: ${name} â€” press SPIN to generate a prompt`;
  // play menu music if declared
  if(theme.music && theme.music.menu){
    playThemeMusic(theme.music.menu);
  } else {
    stopAudio();
  }
}

// audio helpers - ensure no overlap
function stopAudio(){
  if(currentAudio){
    try{ currentAudio.pause(); currentAudio.currentTime = 0; } catch(e){}
    currentAudio = null;
  }
}
function playThemeMusic(src){
  // stop any current audio first
  stopAudio();
  try{
    currentAudio = new Audio(src);
    currentAudio.loop = true;
    currentAudio.muted = isMuted;
    currentAudio.volume = 0.7;
    currentAudio.play().catch(()=>{/* play blocked on mobile until user interacts; ok */});
  } catch(e){ console.warn('audio play failed', e); }
}
function playSpinMusic(src){
  // stop previous short music, but keep it non-looping
  stopAudio();
  try{
    currentAudio = new Audio(src);
    currentAudio.muted = isMuted;
    currentAudio.volume = 0.9;
    currentAudio.loop = false;
    currentAudio.play().catch(()=>{/* autoplay may be blocked */});
  } catch(e){}
}

// spin logic: animate each slot by rapidly swapping text, then stop after a delay
function spin(allFast=false){
  if(isSpinning) return;
  isSpinning = true;
  spinBtn.disabled = true;
  document.body.classList.add('spin-active');
  finalPhrase.textContent = 'Spinningâ€¦';

  const theme = themes[currentTheme];
  const speedFactor = Number(speedRange.value); // 1..3
  const baseInterval = allFast ? 50 : 120; // smaller = faster
  const intervals = [
    baseInterval / speedFactor,
    (baseInterval*1.1) / speedFactor,
    (baseInterval*1.4) / speedFactor,
    (baseInterval*1.8) / speedFactor
  ];

  // clear existing intervals/timeouts
  intervalHandles.forEach(h => clearInterval(h)); intervalHandles = [];
  stopTimeouts.forEach(t => clearTimeout(t)); stopTimeouts = [];  

  // arrays to spin through
  const arrays = [theme.roles, theme.subjects, theme.actions, theme.contexts];

  // start per-slot interval
  for(let i=0;i<4;i++){
    const el = slotElements[i];
    // safety: if array missing fill with placeholder
    const arr = arrays[i] && arrays[i].length ? arrays[i] : ['â€”'];
    const handle = setInterval(()=> {
      el.textContent = pickRandom(arr);
    }, intervals[i]);
    intervalHandles.push(handle);
  }

  // play spin music (non looping) if available
  if(theme.music && theme.music.spin){
    playSpinMusic(theme.music.spin);
  }

  // stop times are staggered and slightly randomized
  const stopDelays = [
    1000 + Math.random()*300,
    1400 + Math.random()*400,
    1900 + Math.random()*500,
    2200 + Math.random()*700
  ];

  // scale stop timings by speed factor (higher speed -> shorter)
  for(let i=0;i<4;i++){
    const delay = stopDelays[i] / speedFactor;
    const t = setTimeout(()=> {
      // stop this slot interval
      clearInterval(intervalHandles[i]);
      intervalHandles[i] = null;
      // set to final pick from its bank
      const arr = arrays[i] && arrays[i].length ? arrays[i] : ['â€”'];
      slotElements[i].textContent = pickRandom(arr);

      // when final slot stopped, finish spin sequence
      if(i === 3){
        finishSpin();
      }
    }, delay);
    stopTimeouts.push(t);
  }
}

// called when everything has stopped
function finishSpin(){
  isSpinning = false;
  spinBtn.disabled = false;
  document.body.classList.remove('spin-active');

  // build sentence in order Roles Subjects Actions Contexts
  const role = slotElements[0].textContent;
  const subj = slotElements[1].textContent;
  const act = slotElements[2].textContent;
  const ctx = slotElements[3].textContent;
  const phrase = `${role} ${act} ${subj} ${ctx}`;
  finalPhrase.textContent = phrase;

  // confetti explosion
  launchConfetti();

  // if spin music ended earlier it won't loop; if you want menu music to resume,
  // re-play menu music after short delay
  const theme = themes[currentTheme];
  if(theme.music && theme.music.menu){
    setTimeout(()=> { if(!isSpinning) playThemeMusic(theme.music.menu); }, 1200);
  }
}

// initial build
createSlots();
buildThemeButtons();
loadTheme(currentTheme);

// UI wiring
spinBtn.addEventListener('click', ()=> spin(false));
quickSpinBtn.addEventListener('click', ()=> spin(true));
speedRange.addEventListener('input', ()=> {
  // small UI effect: pulse the spin dot briefly
  const dot = document.getElementById('spinDot');
  dot.style.transform = 'scale(1.35)';
  setTimeout(()=> dot.style.transform = '', 200);
});

// credits toggle (small)
document.getElementById('creditsToggle').addEventListener('click', ()=>{
  const txt = creditArea.textContent.includes('Made by') ? 'Design by You â€¢ Music: add your credits' : 'Made by You â€¢ Credits here';
  creditArea.textContent = txt;
});

// prevent overlapping quick presses (disable spin while spinning)
// already enforced via isSpinning & disabled button

// --- Confetti system ---
const confetti = confettiCanvas;
const ctx = confetti.getContext('2d');
let confettiPieces = [];
function resizeConfetti(){ confetti.width = window.innerWidth; confetti.height = window.innerHeight; }
window.addEventListener('resize', resizeConfetti);
resizeConfetti();

function rand(min,max){ return Math.random()*(max-min)+min; }
function makePiece(x,y){
  return {
    x,y,
    vx: rand(-6,6),
    vy: rand(-12,-4),
    size: rand(6,14),
    rot: rand(0,360),
    vr: rand(-8,8),
    color: ['#ff6b6b','#ffd166','#6ee7b7','#60a5fa','#c084fc'][Math.floor(Math.random()*5)],
    life: 0,
    ttl: rand(60,120)
  };
}
function launchConfetti(){
  // spawn lots of pieces
  const cx = window.innerWidth/2, cy = window.innerHeight/3;
  for(let i=0;i<120;i++){
    confettiPieces.push(makePiece(cx + rand(-200,200), cy + rand(-50,50)));
  }
  runConfetti();
}
let confettiAnim = null;
function runConfetti(){
  if(confettiAnim) return;
  function frame(){
    ctx.clearRect(0,0,confetti.width,confetti.height);
    for(let i=confettiPieces.length-1;i>=0;i--){
      const p = confettiPieces[i];
      p.life++;
      p.vy += 0.35; // gravity
      p.x += p.vx;
      p.y += p.vy;
      p.rot += p.vr;
      // draw rectangle
      ctx.save();
      ctx.translate(p.x, p.y);
      ctx.rotate(p.rot * Math.PI/180);
      ctx.fillStyle = p.color;
      ctx.fillRect(-p.size/2, -p.size/2, p.size, p.size*0.6);
      ctx.restore();

      if(p.y > confetti.height + 50 || p.life > p.ttl){
        confettiPieces.splice(i,1);
      }
    }
    if(confettiPieces.length>0){
      confettiAnim = requestAnimationFrame(frame);
    } else {
      cancelAnimationFrame(confettiAnim);
      confettiAnim = null;
      ctx.clearRect(0,0,confetti.width,confetti.height);
    }
  }
  confettiAnim = requestAnimationFrame(frame);
}

// keyboard accessibility: space to spin, s for quick spin
window.addEventListener('keydown', (e)=>{
  if(e.code === 'Space'){ e.preventDefault(); spin(false); }
  if(e.key === 's' || e.key === 'S'){ spin(true); }
});

// Initial note: replace the placeholder arrays & audio names above with your theme details.
// When you're ready, paste your theme lists (roles/subjects/actions/contexts for each theme)
// and the filenames for menu/spin music. The audio files should be accessible relative to this file.

</script>
</body>
</html>
