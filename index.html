<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ultra Prompt Machine â€” Illustrated</title>
<style>
  :root{
    --bg:#0f1226;
    --panel:#1b1f3a;
    --accent:#ffd24d;
    --muted:#cbd5ff;
    --glass: rgba(255,255,255,0.06);
    font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  html,body{height:100%;margin:0;background:linear-gradient(180deg,#081026 0%, #071229 60%); color: #fff;}
  .app {
    max-width:1100px;
    margin:24px auto;
    padding:18px;
    display:grid;
    grid-template-columns: 540px 1fr;
    gap:20px;
    align-items:start;
  }

  .machine {
    background: linear-gradient(180deg,#121428 0%, #0f1528 100%);
    border-radius:20px;
    padding:18px;
    box-shadow: 0 12px 40px rgba(0,0,0,0.6), inset 0 2px 10px rgba(255,255,255,0.02);
    position:relative;
  }
  .header {
    display:flex;align-items:center;gap:12px;margin-bottom:12px;
  }
  .logo {
    width:78px;height:78px;border-radius:14px;background:linear-gradient(180deg,#3b2a6f,#26204b);
    display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--accent);
    box-shadow: 0 6px 18px rgba(0,0,0,0.5);
    transform: rotate(-6deg);
  }
  .title {font-size:22px; font-weight:700; color:var(--accent);}
  .subtitle {font-size:12px; color:var(--muted); margin-top:4px;}

  .slot-face {
    background: linear-gradient(180deg,#0b0f1b,#0f1420);
    border-radius:14px;
    padding:18px;
    display:flex;flex-direction:column;align-items:center;
    border: 2px solid rgba(255,255,255,0.03);
  }
  .reels {
    width:100%;
    display:flex;
    gap:14px;
    justify-content:center;
    margin-bottom:16px;
  }
  .reel {
    flex:1;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:10px;
    padding:22px 8px;
    height:100px; /* lock reel height to stop glitching */
    display:flex;
    align-items:center;
    justify-content:center;
    position:relative;
    overflow:hidden;
    box-shadow: 0 6px 18px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
  }
  .word {
    font-size:30px; font-weight:700; text-align:center; letter-spacing:0.6px;
    transition: transform 120ms ease, color 120ms linear;
    display:inline-block;
    max-width:220px;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }

  .controls {
    display:flex; gap:12px; align-items:center; justify-content:space-between;width:100%;
  }
  .left-controls {display:flex; gap:8px; align-items:center;}
  .theme-btn {
    background:var(--glass); padding:8px 12px; border-radius:12px; color:var(--muted); border:1px solid rgba(255,255,255,0.03);
    cursor:pointer; font-weight:600;
  }
  .theme-btn.selected { box-shadow: 0 6px 20px rgba(255,210,77,0.08); border-color: rgba(255,210,77,0.14); color:var(--accent); }

  .lever-area { width:160px; display:flex; justify-content:center; align-items:center; height:140px; position:relative; }
  .lever {
    width:56px; height:120px; background:linear-gradient(180deg,#592c78,#351a4a); border-radius:12px; box-shadow: 0 8px 24px rgba(0,0,0,0.6);
    transform-origin: top center;
    display:flex; align-items:flex-end; justify-content:center; padding-bottom:8px; cursor:pointer;
    transition: transform 220ms cubic-bezier(.2,.9,.3,1);
  }
  .lever.grabbed { transform: rotate(18deg) translateY(6px) scale(0.98); }
  .lever-knob { width:38px; height:38px; background: radial-gradient(circle at 30% 30%, #ffd24d, #ffb62e); border-radius:50%; box-shadow: 0 6px 18px rgba(0,0,0,0.6);}

  .side {
    background: linear-gradient(180deg,#0b1220,#071029);
    border-radius:14px; padding:16px; min-height:420px; box-shadow: 0 12px 40px rgba(0,0,0,0.6);
  }
  .tracker-list { margin-top:12px; display:grid; gap:8px; max-height:520px; overflow:auto; padding-right:8px; }
  .tracker-item { background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:10px; border-radius:10px; display:flex; justify-content:space-between; align-items:center; }
  .small { font-size:13px; color:var(--muted); }

  canvas.confetti { position:fixed; left:0; top:0; width:100%; height:100%; pointer-events:none; z-index:999; }
  .footer { margin-top:12px; color:var(--muted); font-size:13px; text-align:center; }

  @media (max-width:1000px){
    .app{grid-template-columns: 1fr; padding:12px;}
    .lever-area { width:120px; }
    .reel .word { font-size:24px; }
  }
</style>
</head>
<body>
<div class="app">
  <div class="machine">
    <div class="header">
      <div class="logo">UP</div>
      <div>
        <div class="title">Ultra Prompt Machine</div>
        <div class="subtitle">Pull the lever to spin</div>
      </div>
    </div>

    <div class="slot-face">
      <div class="reels" id="reels">
        <div class="reel"><div class="word" data-index="0">â€”</div></div>
        <div class="reel"><div class="word" data-index="1">â€”</div></div>
        <div class="reel"><div class="word" data-index="2">â€”</div></div>
        <div class="reel"><div class="word" data-index="3">â€”</div></div>
      </div>

      <div class="controls">
        <div class="left-controls" id="themeButtons"></div>
        <button id="muteButton" class="theme-btn" aria-label="Mute/unmute sound">ðŸ”‡</button>
        <div class="lever-area">
          <div id="lever" class="lever" role="button" aria-label="Pull lever to spin">
            <div class="lever-knob"></div>
          </div>
        </div>
      </div>

      <div class="footer small">Tip: pull the lever (or tap it) to start.</div>
    </div>
  </div>

  <div class="side">
    <h2 style="margin:2px 0 6px 0">Tracker</h2>
    <div class="small">Tracks how many unique words you've landed per theme / category.</div>
    <div class="tracker-list" id="trackerList"></div>

    <div style="margin-top:12px;">
      <h3 style="margin:6px 0 6px 0">Credits</h3>
      <div class="small">Music and sounds from Pixabay and Freesound. Code and prompts by Alex Crowhurst.</div>
    </div>
  </div>
</div>

<canvas id="confettiCanvas" class="confetti"></canvas>

<!-- Audio -->
<audio id="pingAudio" src="assets/sounds/ping.wav" preload="auto"></audio>
<audio id="menuAudio" src="assets/sounds/menu_theme.mp3" preload="auto" loop></audio>

<script>
/* --------------------------
   PROMPTS & THEMES
--------------------------- */
const THEMES = {
  Space: {
    color: "#8cf1ff",
    music: "assets/sounds/space_theme.mp3",
    words: ["galaxy","orbit","alien","supernova","asteroid","nebula","comet","starlight"]
  },
  Fantasy: {
    color: "#f1a8ff",
    music: "assets/sounds/fantasy_theme.mp3",
    words: ["dragon","sword","castle","wizard","potion","elf","quest","troll"]
  },
  Nature: {
    color: "#a8ffb2",
    music: "assets/sounds/nature_theme.mp3",
    words: ["forest","mountain","river","blossom","rain","storm","meadow","sunrise"]
  }
};

let currentTheme = "Space";
let spinning = false;
let tracker = JSON.parse(localStorage.getItem("promptTracker") || "{}");
const reels = document.querySelectorAll(".word");
const trackerList = document.getElementById("trackerList");
const menuAudio = document.getElementById("menuAudio");
const pingAudio = document.getElementById("pingAudio");
let themeAudio = new Audio(); themeAudio.loop = true;

/* --------------------------
   MUTE BUTTON SYSTEM
--------------------------- */
let isMuted = false;
const muteButton = document.getElementById("muteButton");

function updateMuteIcon() {
  muteButton.textContent = isMuted ? "ðŸ”ˆ" : "ðŸ”‡";
}
muteButton.addEventListener("click", () => {
  isMuted = !isMuted;
  updateMuteIcon();
  if (isMuted) {
    menuAudio.pause();
    themeAudio.pause();
    pingAudio.muted = true;
  } else {
    pingAudio.muted = false;
    try {
      if (spinning && themeAudio.src) themeAudio.play();
      else menuAudio.play();
    } catch(e){}
  }
});
updateMuteIcon();

/* --------------------------
   INITIAL SETUP
--------------------------- */
function buildThemeButtons(){
  const container = document.getElementById("themeButtons");
  Object.keys(THEMES).forEach(name=>{
    const b=document.createElement("button");
    b.className="theme-btn"+(name===currentTheme?" selected":"");
    b.textContent=name;
    b.style.color=THEMES[name].color;
    b.addEventListener("click",()=>setTheme(name));
    container.appendChild(b);
  });
}
function setTheme(name){
  currentTheme=name;
  document.querySelectorAll(".theme-btn").forEach(b=>{
    b.classList.toggle("selected", b.textContent===name);
  });
  themeAudio.pause();
  themeAudio = new Audio(THEMES[name].music);
  themeAudio.loop=true;
  if(!isMuted) themeAudio.play();
  updateTracker();
}
buildThemeButtons();
menuAudio.volume=0.3; if(!isMuted) menuAudio.play();

/* --------------------------
   LEVER + SPINNING LOGIC
--------------------------- */
const lever=document.getElementById("lever");
lever.addEventListener("click", ()=>{
  if(spinning) return;
  lever.classList.add("grabbed");
  setTimeout(()=>lever.classList.remove("grabbed"),400);
  startSpin();
});

function startSpin(){
  spinning=true;
  menuAudio.pause();
  if(!isMuted) themeAudio.play();
  const theme=THEMES[currentTheme];
  reels.forEach(r=>{
    const words=theme.words;
    let i=0;
    const interval=setInterval(()=>{
      r.textContent=words[i%words.length];
      i++;
    },60+Math.random()*60);
    r.dataset.interval=interval;
  });
  setTimeout(stopSpin,1500+Math.random()*500);
}

function stopSpin(){
  reels.forEach(r=>{
    clearInterval(r.dataset.interval);
    const word=randomFrom(THEMES[currentTheme].words);
    r.textContent=word;
  });
  if(!isMuted) pingAudio.play();
  addToTracker();
  spinning=false;
}

function randomFrom(arr){return arr[Math.floor(Math.random()*arr.length)];}

/* --------------------------
   TRACKER
--------------------------- */
function addToTracker(){
  const words=[...reels].map(r=>r.textContent);
  tracker[currentTheme]=tracker[currentTheme]||[];
  words.forEach(w=>{if(!tracker[currentTheme].includes(w)) tracker[currentTheme].push(w);});
  localStorage.setItem("promptTracker", JSON.stringify(tracker));
  updateTracker();
}
function updateTracker(){
  trackerList.innerHTML="";
  Object.keys(THEMES).forEach(theme=>{
    const div=document.createElement("div");
    div.className="tracker-item";
    const count=tracker[theme]?.length||0;
    div.innerHTML=`<span>${theme}</span><span>${count}/${THEMES[theme].words.length}</span>`;
    trackerList.appendChild(div);
  });
}
updateTracker();

/* --------------------------
   CONFETTI
--------------------------- */
const confettiCanvas=document.getElementById("confettiCanvas");
const ctx=confettiCanvas.getContext("2d");
let confetti=[];
function resize(){confettiCanvas.width=window.innerWidth;confettiCanvas.height=window.innerHeight;}
window.addEventListener("resize",resize);resize();
function spawnConfetti(){
  confetti=Array.from({length:50},()=>({
    x:Math.random()*confettiCanvas.width,
    y:Math.random()*-100,
    r:4+Math.random()*4,
    c:`hsl(${Math.random()*360},90%,60%)`,
    s:Math.random()*3+2
  }));
}
function drawConfetti(){
  ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
  confetti.forEach(p=>{
    ctx.fillStyle=p.c;
    ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,Math.PI*2);ctx.fill();
    p.y+=p.s;
  });
  confetti=confetti.filter(p=>p.y<confettiCanvas.height);
  if(confetti.length) requestAnimationFrame(drawConfetti);
}
pingAudio.addEventListener("play",()=>{spawnConfetti();drawConfetti();});

</script>
</body>
</html>
