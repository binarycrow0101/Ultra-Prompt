<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mystic Radio Tuner</title>
<style>
  :root {
    --bg: #0b0b0c;
    --glow: rgba(180,255,200,0.2);
    --text: #b8ffc6;
    --static1: repeating-linear-gradient(0deg, #111 0 1px, #222 1px 2px);
    --static2: repeating-linear-gradient(90deg, transparent 0 2px, rgba(255,255,255,0.03) 2px 3px);
  }
  html,body {
    margin:0;
    padding:0;
    background: var(--bg);
    color: var(--text);
    font-family: 'Courier New', monospace;
    overflow:hidden;
    height:100%;
  }
  .container {
    position: relative;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    height:100%;
  }
  canvas.particles {
    position:absolute;
    top:0; left:0; width:100%; height:100%;
    z-index:1;
    pointer-events:none;
  }
  .static-layer {
    position:absolute;
    top:0;left:0;width:100%;height:100%;
    background-image: var(--static1), var(--static2);
    mix-blend-mode: lighten;
    opacity:0.07;
    animation: flicker 0.2s infinite alternate;
    z-index:2;
    pointer-events:none;
  }
  @keyframes flicker {
    from { opacity: 0.04; }
    to { opacity: 0.12; }
  }
  .tuner {
    position:relative;
    z-index:3;
    display:flex;
    flex-direction:column;
    align-items:center;
  }
  .dial {
    width:140px;
    height:140px;
    border:3px solid var(--text);
    border-radius:50%;
    position:relative;
    background:radial-gradient(circle at 50% 50%, #111 0%, #000 70%);
    box-shadow:0 0 20px var(--glow);
    margin-bottom:20px;
    cursor:grab;
  }
  .dial::after {
    content:"";
    position:absolute;
    width:4px;
    height:50%;
    top:25%;
    left:50%;
    transform:translateX(-50%) rotate(0deg);
    transform-origin:bottom center;
    background:var(--text);
    border-radius:2px;
  }
  .screen {
    background:#000;
    border:2px solid var(--text);
    padding:15px;
    min-height:100px;
    width:80%;
    max-width:400px;
    text-align:center;
    box-shadow:0 0 10px var(--glow);
    font-size:1.1em;
    z-index:3;
  }
  .channel-label {
    margin-top:15px;
    font-size:14px;
    opacity:0.8;
  }
</style>
</head>
<body>
<div class="container">
  <canvas class="particles"></canvas>
  <div class="static-layer"></div>
  <div class="tuner">
    <div class="dial" id="dial"></div>
    <div class="screen" id="screen">Tuning in...</div>
    <div class="channel-label" id="channelLabel">Channel: Fantasy</div>
  </div>
</div>

<script>
/* === PARTICLE BACKGROUND === */
const canvas = document.querySelector('.particles');
const ctx = canvas.getContext('2d');
let w, h, particles;
function resize() {
  w = canvas.width = window.innerWidth;
  h = canvas.height = window.innerHeight;
  particles = Array.from({length: 80}, () => ({
    x: Math.random() * w,
    y: Math.random() * h,
    r: Math.random() * 2 + 0.5,
    s: Math.random() * 0.5 + 0.2
  }));
}
window.addEventListener('resize', resize);
resize();
function drawParticles() {
  ctx.clearRect(0,0,w,h);
  ctx.fillStyle = 'rgba(180,255,200,0.1)';
  for (let p of particles) {
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
    ctx.fill();
    p.y -= p.s;
    if (p.y < 0) p.y = h;
  }
  requestAnimationFrame(drawParticles);
}
drawParticles();

/* === DIAL & PROMPT LOGIC === */
const dial = document.getElementById('dial');
const screen = document.getElementById('screen');
const label = document.getElementById('channelLabel');

let angle = 0;
let dragging = false;
let currentChannel = 0;
const channels = ['Fantasy','Sci-Fi','Spooky','Silly','Superhero','Mashup'];

const wordBanks = {
  Fantasy: {
    roles: ['Knight','Sorcerer','Goblin','Queen','Apprentice','Wanderer'],
    subjects: ['dragon egg','enchanted forest','ancient rune','crystal tower','cursed blade'],
    actions: ['discovers','steals','awakens','banishes','protects','summons'],
    contexts: ['during a blood moon','under a silent curse','at dawnâ€™s edge','within forgotten ruins']
  },
  'Sci-Fi': {
    roles: ['Android','Pilot','Scientist','Smuggler','Alien','Clone'],
    subjects: ['quantum drive','space station','AI core','black hole map','plasma rifle'],
    actions: ['decodes','sabotages','escapes','uploads','constructs'],
    contexts: ['beyond the Andromeda Gate','during a solar flare','inside a wormhole']
  },
  'Spooky': {
    roles: ['Ghost','Medium','Vampire','Caretaker','Witch','Child'],
    subjects: ['mirror','lantern','coffin','old photograph','ritual circle'],
    actions: ['whispers to','haunts','possesses','reveals','warns'],
    contexts: ['as thunder rolls','beneath the graveyard','when the candles die']
  },
  'Silly': {
    roles: ['Clown','Duck','Robot Chef','Grandma','Banana Knight','Hamster'],
    subjects: ['toaster','rubber chicken','balloon army','pudding cannon','sock puppet'],
    actions: ['battles','tickles','juggles','confuses','teleports'],
    contexts: ['on laundry day','during tea time','inside a bouncy castle']
  },
  'Superhero': {
    roles: ['Vigilante','Sidekick','Villain','Mutant','Hero','Inventor'],
    subjects: ['power glove','secret lair','time crystal','jet boots','mask'],
    actions: ['charges','melts','rescues','clones','explodes'],
    contexts: ['during a city blackout','at the final showdown','in a paradox loop']
  },
  'Mashup': {
    roles: ['Pirate','Astronaut','Goblin','Detective','Mermaid','Zombie'],
    subjects: ['portal key','laser cutlass','enchanted donut','haunted typewriter'],
    actions: ['steals','fixes','bakes','investigates','teleports'],
    contexts: ['between worlds','on a flying ship','in 1980s Tokyo','during breakfast']
  }
};

function generatePrompt(theme) {
  const set = wordBanks[theme];
  const r = arr => arr[Math.floor(Math.random()*arr.length)];
  return `${r(set.roles)} ${r(set.subjects)} ${r(set.actions)} ${r(set.contexts)}.`;
}

function showStaticAssemblingText(text) {
  screen.innerHTML = '';
  let output = '';
  const chars = text.split('');
  let i = 0;
  const interval = setInterval(()=>{
    if(Math.random()<0.3) screen.innerHTML = output + '<span style="opacity:0.4">' + String.fromCharCode(33+Math.random()*94|0) + '</span>';
    else {
      output += chars[i];
      screen.innerHTML = output;
      i++;
      if (i >= chars.length) {
        clearInterval(interval);
      }
    }
  }, 40);
}

function tuneToChannel(idx) {
  currentChannel = idx;
  const theme = channels[idx];
  label.textContent = `Channel: ${theme}`;
  const phrase = generatePrompt(theme);
  showStaticAssemblingText(phrase);
}

/* === Dial Rotation Handling === */
dial.addEventListener('mousedown', ()=> dragging=true);
window.addEventListener('mouseup', ()=> dragging=false);
window.addEventListener('mousemove', e=>{
  if(!dragging) return;
  const rect = dial.getBoundingClientRect();
  const cx = rect.left + rect.width/2;
  const cy = rect.top + rect.height/2;
  const dx = e.clientX - cx;
  const dy = e.clientY - cy;
  angle = Math.atan2(dy,dx) * 180/Math.PI + 90;
  dial.style.transform = `rotate(${angle}deg)`;
  const idx = Math.floor(((angle+360)%360)/60) % channels.length;
  if(idx !== currentChannel) tuneToChannel(idx);
});
</script>
</body>
</html>
