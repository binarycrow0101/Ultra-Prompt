<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Mystic Radio Tuner</title>
<style>
  body {
    margin: 0;
    height: 100vh;
    background: radial-gradient(circle at center, #050505 30%, #000 100%);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-family: "Courier New", monospace;
    color: #0ff;
    overflow: hidden;
  }

  .screen {
    width: 440px;
    max-width: 90vw;
    height: 160px;
    background: #001;
    border: 3px solid #0ff5;
    box-shadow: 0 0 30px #0ff2;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #0ff;
    font-size: 1.1em;
    text-align: center;
    position: relative;
    overflow: hidden;
  }

  .screen::after {
    content: "";
    position: absolute;
    inset: 0;
    background: repeating-linear-gradient(
      rgba(255,255,255,0.03) 0px,
      rgba(255,255,255,0.03) 2px,
      rgba(0,0,0,0.05) 3px
    );
    animation: flicker 0.25s infinite;
    pointer-events: none;
  }

  @keyframes flicker {
    0%,100% { opacity: 0.9; }
    50% { opacity: 0.6; }
  }

  .dial {
    width: 160px;
    height: 160px;
    background: radial-gradient(circle, #222 0%, #000 90%);
    border: 4px solid #0ff5;
    border-radius: 50%;
    margin-top: 50px;
    position: relative;
    box-shadow: 0 0 30px #0ff2 inset;
    cursor: grab;
  }

  .pointer {
    position: absolute;
    width: 4px;
    height: 50px;
    background: #0ff;
    top: 15px;
    left: calc(50% - 2px);
    border-radius: 2px;
    transform-origin: bottom center;
  }

  .static {
    animation: staticText 0.15s steps(5) 12;
  }

  @keyframes staticText {
    0%,100% { opacity: 1; filter: blur(0); }
    25% { opacity: 0.3; filter: blur(2px); }
    50% { opacity: 1; filter: blur(1px); }
    75% { opacity: 0.6; filter: blur(3px); }
  }

  .mist {
    position: absolute;
    width: 800px;
    height: 800px;
    top: -300px;
    background: radial-gradient(circle, rgba(0,255,255,0.1) 0%, transparent 70%);
    filter: blur(100px);
    animation: drift 20s linear infinite alternate;
  }

  @keyframes drift {
    from { transform: translateX(-100px) translateY(0px); }
    to { transform: translateX(100px) translateY(50px); }
  }

  .assembled {
    transition: opacity 0.5s ease;
  }

  .fade-out {
    opacity: 0;
  }
</style>
</head>
<body>
  <div class="mist"></div>
  <div class="screen" id="screen">~ tuning ~</div>
  <div class="dial" id="dial">
    <div class="pointer" id="pointer"></div>
  </div>

<script>
// ---------------- AUDIO SETUP ----------------
const sounds = {
  static: new Audio('sounds/static.mp3'),
  click: new Audio('sounds/click.mp3'),
  lock: new Audio('sounds/lock.mp3'),
  hum: new Audio('sounds/hum.mp3'),
  blip: new Audio('sounds/blip.mp3'),
  bgm: new Audio('sounds/background.mp3')
};

// base config
sounds.hum.loop = true;
sounds.hum.volume = 0.15;
sounds.hum.playbackRate = 1;

sounds.bgm.loop = true;
sounds.bgm.volume = 0.2;
sounds.bgm.playbackRate = 1;

// allow playback after gesture
document.addEventListener('click', () => {
  [sounds.hum, sounds.bgm].forEach(s => {
    if (s.paused) s.play().catch(()=>{});
  });
}, { once: true });

// ---------------- ELEMENTS ----------------
const screen = document.getElementById('screen');
const dial = document.getElementById('dial');
const pointer = document.getElementById('pointer');

let currentAngle = 0;
let dragging = false;
let lastAngle = 0;
let lastChannel = -1;

// ---------------- CHANNELS ----------------
const channels = [
  { name: "Goblin Frequencies", generator: goblinPrompt },
  { name: "Dream Residue", generator: dreamPrompt },
  { name: "Mortal Mashups", generator: mashupPrompt },
  { name: "Haunted Folklore", generator: folklorePrompt },
  { name: "Void Noise", generator: voidPrompt }
];

// ---------------- PROMPT GENERATORS ----------------
function goblinPrompt() {
  const g=["Grib","Snort","Mog","Kreeg","Thistle","Fungrot"],
        a=["ate","bargained with","stole from","sang to","was cursed by"],
        o=["a glowing rat","the moon's toenail","a bucket of screams","a noble sock"];
  return `${rand(g)} ${rand(a)} ${rand(o)}.`;
}

function dreamPrompt() {
  const roles = ["Frog","Elephant","Boar","Raven","Giraffe","Tapir","Weasel","Otter","Beaver","Buffalo","Cow","Spider","Rabbit","Dog","Dinosaur","Octopus","Penguin","Crab","Cat","Bear","Lion","Badgers","Xenomorph","Android","Shark","Unicorn","Shrimp","Raccoon","Turtle","Rat","Pony","Tiger","Ant","Bat","Koala","Sloth","Dragon","Chinchilla","Skeleton","Pigeon","Lobster","Walrus","Armadillo","Chicken","Goblin","Mermaid","Centaur","Werewolf","Vampire Bat","Gnome","Fairy","Alien Blob","Robot Dog","Mutant Hamster","Zombie Cat","Cyborg Chicken","Mini Dragon","Space Slug","Tentacle Monster","Flying Fish","Talking Donkey","Living Rock","A Painting of a","Haunted Doll","Giant Rat","Fire Sprite","Ice Golem","Shadow Beast","Moon Rabbit","Pumpkin Monster","Cosmic Owl","Time Traveler","Ghost Parrot","Invisible Cat","Frost Troll","Sand Worm","Giant Spider","Banana Knight","Chocolate Ogre","Cheese Dragon","Sock Monster","Killer Whale","Fox","Neon Tiger","Gummy Bear","Jellyfish","Vortex Frog","Crazy Chicken"];
  const subjects = ["Knight","Wizard","Healer","Archer","Bard","Thief","Necromancer","Paladin","Barbarian","Alchemist","Engineer","Inventor","Pilot","Captain","Admiral","Navigator","Spy","Assassin","Scout","Soldier","General","Guard","Jester","King","Queen","Prince","Princess","Peasant","Farmer","Blacksmith","Miner","Merchant","Scholar","Librarian","Teacher","Student","Priest","Monk","Oracle","Prophet","Shaman","Druid","Hunter","Fisherman","Cook","Butcher","Baker","Brewer","Innkeeper","Explorer","Cartographer","Sailor","Pirate","Smuggler","Outlaw","Sheriff","Deputy","Detective","Investigator","Doctor","Surgeon","Nurse","Witch Doctor","Mechanic","Taxi Driver","Racer","Athlete","Gladiator","Champion","Wrestler","Boxer","Samurai","Ronin","Ninja","Sensei","Mentor","Apprentice","Magician","Illusionist","Fortune Teller","Trickster","Hero","Villain","Antihero","Rebel","Revolutionary","Diplomat","Ambassador","Politician","Judge","Lawyer","Banker","Thug","Crime Boss","Cult Leader","Prophet of Doom","Herald","Courier","Wanderer","Hermit","Nomad","Survivor","Scientist","Astronaut","Alien","Robot","Hacker","AI Core","Space Marine","Influencer","Starship Captain","Time Traveler","Historian","Archivist","Storyteller","Painter","Musician","Sculptor","Poet","Philosopher","Dreamer","Visionary","Madman","Trickster God","Demi-God","Spirit Guardian","Elemental","Shape-shifter","CEO","Zombie","Vampire","Muppet","Sock Puppet","Kaiju","Transforming","Hippy","Crusty"];
  const actions = ["dancing","sleeping","baking cupcakes","juggling","painting","singing","fighting","building a Lego set","haunting","surfing","moonwalking","shopping","arguing","reading","working","driving a golf cart","climbing","eating cheese","solving a mystery","being disgusted","poisoned","slaying","pumping iron","playing the bassoon","having a tea party","competing in a staring match","raising money","presenting their ideas","speed dating","performing a musical","wearing tiny trousers","sharing a dessert","dying","laughing","serving drinks","cutting hair","playing football","playing soccer","bringing the ruckus","comparing hats","playing pinball","checking the goods","fishing","wearing a jacket made of cheese","carving wooden spoons","making a secret deal","eating pizza","riding a T-Rex","participating in a hotdog eating contest","casting spells","summoning a storm","building a time machine","hacking a computer","climbing a volcano","riding a giant snail","teleporting","sneaking past guards","playing hide and seek","chasing shadows","taming a dragon","stealing treasure","creating a potion","swinging on vines","jumping through portals","painting graffiti","singing opera","writing a novel","escaping a maze","inventing gadgets","dancing on rooftops","riding a comet","dueling with swords","feeding unicorns","swimming with sharks","riding a mechanical horse","playing pranks","solving riddles","baking a magical cake","testing a jetpack","training minions","fighting off zombies","wrangling ghosts","building a cheese fortress","stealing a crown","casting shadow puppets","racing kangaroos","wrestling giant frogs","conducting an orchestra","driving a UFO"];
  const contexts = ["in the Congo","at a TED convention","in a castle","in a spaceship","on the moon","in a haunted house","in a circus","in a swamp","in a library","in a volcano","in a coffee shop","at a wedding","at a funeral","in a classroom","on a pirate ship","on stage","in a candy store","in a barber shop","at a fashion show","in a pub","at Disney World","in the big city","on set of a movie shoot","at the gym","in hospital","at a saloon","in a cheese factory","off a cliffs edge","in a field battle","in a thrift store","during an earthquake","on a zoom call","during armageddon","in a sewer","on the subway","in hell","at the laundromat","in the middle of traffic","during karaoke night","at a silent disco","in a gladiator arena","at a bus stop","on a cloud","inside a volcano","underwater in Atlantis","on a flying carpet","in a haunted forest","inside a giant pumpkin","at a zombie apocalypse","during a snowstorm","on a rollercoaster","in a neon city","inside a video game","on a space station","in a cave of crystals","on a pirate island","during a magic duel","in a labyrinth","on a tropical island","in a candy factory","at a wizard school","in a secret laboratory","on a comet","in a junkyard","on a train to nowhere","inside a giant robot","on top of a giant cake","in a miniature village","during a monster invasion","inside a snow globe","on the set of a reality show","in a haunted carnival","inside a magical mirror","at a superhero battle","in a library of forbidden books","under the city streets","on a mountaintop temple","inside a giant clock","in a dimension of upside-down physics","on a floating island","in a circus of illusions","at the edge of time"];
  return `${rand(roles)} ${rand(subjects)} ${rand(actions)} ${rand(contexts)}.`;
}

function mashupPrompt() {
  const r=["Knight","DJ","Goblin","Astrologer","Beekeeper"],
        s=["Vampire","Robot","Chef","Detective","Witch"],
        p=["in Space","in a Dungeon","at a Tea Party","during Apocalypse","underwater"];
  return `${rand(r)} vs ${rand(s)} ${rand(p)}.`;
}

function folklorePrompt() {
  const b=["The Hollow Piper","The Candle Mare","The Mirror Child","The Bleeding Oak"],
        p=["walks when no one watches","sings through keyholes","feeds on reflected light","collects forgotten birthdays"];
  return `${rand(b)} ${rand(p)}.`;
}

function voidPrompt() {
  const n=["⧫ ░ø∆Ψ∴ whispers ∵ Ψ∆ø░ ⧫","The void hums, slightly off-key.","Untranslatable frequencies detected..."];
  return rand(n);
}

function rand(a){return a[Math.floor(Math.random()*a.length)];}

// ---------------- DIAL INTERACTION ----------------
function angleFromEvent(e){
  const rect=dial.getBoundingClientRect();
  const cx=rect.left+rect.width/2;
  const cy=rect.top+rect.height/2;
  const dx=(e.touches?e.touches[0].clientX:e.clientX)-cx;
  const dy=(e.touches?e.touches[0].clientY:e.clientY)-cy;
  return Math.atan2(dy,dx)*180/Math.PI;
}

dial.addEventListener('mousedown',startDrag);
dial.addEventListener('touchstart',startDrag);
document.addEventListener('mouseup',stopDrag);
document.addEventListener('touchend',stopDrag);
document.addEventListener('mousemove',dragMove);
document.addEventListener('touchmove',dragMove);

function startDrag(e){
  dragging=true;
  lastAngle=angleFromEvent(e);
  dial.style.cursor='grabbing';
  sounds.click.play().catch(()=>{});
  sounds.static.currentTime=0;
  sounds.static.volume=0.4;
  sounds.static.loop=true;
  sounds.static.play().catch(()=>{});
}

function stopDrag(){
  dragging=false;
  dial.style.cursor='grab';
  sounds.static.pause();

  // smoothly reset hum and bgm to normal
  smoothReset();
}

function dragMove(e){
  if(!dragging)return;
  const newAngle=angleFromEvent(e);
  const delta=newAngle-lastAngle;
  currentAngle=(currentAngle+delta)%360;
  lastAngle=newAngle;
  pointer.style.transform=`rotate(${currentAngle}deg)`;
  checkChannel();
  
  // detune sound subtly
  const drift = Math.sin(Date.now()/200) * 0.05;
  const detune = 1 + (delta/90) + drift;
  sounds.hum.playbackRate = clamp(detune, 0.8, 1.2);
  sounds.bgm.playbackRate = clamp(detune, 0.85, 1.15);
  sounds.hum.volume = clamp(0.15 + Math.abs(delta/200), 0.1, 0.3);
  sounds.bgm.volume = clamp(0.18 + Math.abs(delta/300), 0.1, 0.25);
}

function clamp(v,min,max){return Math.max(min,Math.min(max,v));}

function smoothReset(){
  const duration = 600;
  const startHum = sounds.hum.playbackRate;
  const startBgm = sounds.bgm.playbackRate;
  const startTime = Date.now();
  const fade = setInterval(()=>{
    const t=(Date.now()-startTime)/duration;
    if(t>=1){
      sounds.hum.playbackRate=1;
      sounds.bgm.playbackRate=1;
      sounds.hum.volume=0.15;
      sounds.bgm.volume=0.2;
      clearInterval(fade);
    } else {
      sounds.hum.playbackRate = startHum + (1 - startHum)*t;
      sounds.bgm.playbackRate = startBgm + (1 - startBgm)*t;
    }
  },30);
}

function checkChannel(){
  const segmentSize=360/channels.length;
  let channelIndex=Math.floor((currentAngle+360)%360/segmentSize);
  if(channelIndex!==lastChannel){
    lastChannel=channelIndex;
    const channel=channels[channelIndex];
    showStatic(channel.name);
    setTimeout(()=>displayPhrase(channel.generator()),600);
  }
}

function showStatic(label){
  screen.textContent=`~ ${label} ~`;
  screen.classList.add('static');
  setTimeout(()=>screen.classList.remove('static'),400);
  sounds.static.currentTime=0;
  sounds.static.play().catch(()=>{});
}

function displayPhrase(text){
  screen.innerHTML="";
  const span=document.createElement('span');
  span.textContent=text;
  span.classList.add('assembled');
  screen.appendChild(span);

  fadeVolume(sounds.bgm, 0.1, 500);
  
  setTimeout(()=>{
    span.classList.remove('fade-out');
    sounds.static.pause();
    sounds.lock.currentTime=0;
    sounds.lock.play().catch(()=>{});
    sounds.blip.currentTime=0;
    sounds.blip.play().catch(()=>{});
  },300);
}

function fadeVolume(sound, target, duration){
  const start = sound.volume;
  const startTime = Date.now();
  const step = setInterval(()=>{
    const t = Math.min(1, (Date.now()-startTime)/duration);
    sound.volume = start + (target-start)*t;
    if(t===1) clearInterval(step);
  }, 30);
}
</script>
</body>
</html>
